# 赛博玄数 - 用户侧测试指南

**测试版本**: Phase 6集成版本
**测试时间**: 2025-12-31起
**测试目标**: 验证所有新增功能正常工作，发现潜在问题

---

## 📋 目录

1. [测试环境准备](#1-测试环境准备)
2. [测试范围](#2-测试范围)
3. [测试方法](#3-测试方法)
4. [功能测试清单](#4-功能测试清单)
5. [性能测试](#5-性能测试)
6. [异常场景测试](#6-异常场景测试)
7. [测试报告模板](#7-测试报告模板)

---

## 1. 测试环境准备

### 1.1 环境要求

**操作系统**：
- ✅ Windows 10/11
- ✅ macOS 12+
- ✅ Linux (Ubuntu 20.04+)

**Python版本**：
- ✅ Python 3.10+

**依赖安装**：
```bash
cd cyber_mantic
pip install -r requirements.txt
```

### 1.2 配置准备

**API密钥配置**（至少配置一个）：
1. 复制`.env.example`为`.env`
2. 填写API密钥：
   ```bash
   CLAUDE_API_KEY=sk-ant-api03-...
   DEEPSEEK_API_KEY=sk-...
   GEMINI_API_KEY=AIza...
   KIMI_API_KEY=sk-...
   ```

**数据库初始化**：
```bash
# 首次运行会自动创建数据库
python main.py
```

### 1.3 测试数据准备

**测试用例数据**：
```python
# 测试出生信息
test_birth_info = {
    "阳历": {
        "year": 1990,
        "month": 5,
        "day": 20,
        "hour": 15,
        "minute": 30
    },
    "农历": {
        "year": 1990,
        "month": 4,
        "day": 26,
        "is_leap": False,
        "hour": 15
    }
}

# 测试问题
test_questions = {
    "事业": "我今年的工作运势如何，适合跳槽吗？",
    "财运": "最近财运怎么样，适合投资股票吗？",
    "感情": "我和她的感情会有结果吗？",
    "婚姻": "什么时候适合结婚？",
    "健康": "我的身体健康状况如何？",
    "学业": "今年考研能成功吗？",
    "综合": "帮我综合看看运势"
}
```

### 1.4 日志查看

**日志位置**：`logs/cyber_mantic.log`

**实时查看日志**（Linux/macOS）：
```bash
tail -f logs/cyber_mantic.log
```

**实时查看日志**（Windows）：
```powershell
Get-Content logs/cyber_mantic.log -Wait -Tail 50
```

---

## 2. 测试范围

### 2.1 核心功能（必测）

| 模块 | 功能点 | 优先级 |
|-----|--------|--------|
| **分析功能** | 基础八字分析 | 🔴 P0 |
| **分析功能** | 多理论综合分析 | 🔴 P0 |
| **AI对话** | 9步智能交互 | 🔴 P0 |
| **历史记录** | 保存、查看、删除 | 🔴 P0 |
| **导出功能** | JSON/PDF/Markdown导出 | 🟡 P1 |
| **报告问答** | 针对历史报告提问 | 🟡 P1 |
| **历史对比** | 两份报告对比分析 | 🟡 P1 |
| **报告自定义** | AI生成自定义模板 | 🟢 P2 |
| **主题切换** | 3种主题 + 自动切换 | 🟢 P2 |
| **功能状态** | 状态面板显示 | 🟢 P2 |

### 2.2 Phase 1-6新增功能（重点测试）

**Phase 1**: 服务层
- ✅ ConversationService
- ✅ ReportService
- ✅ AnalysisService
- ✅ ExportService

**Phase 2**: 交互组件
- ✅ ChatWidget
- ✅ ProgressWidget

**Phase 3**: AI对话标签页
- ✅ 9步智能交互
- ✅ 对话保存

**Phase 4**: 报告自定义
- ✅ 模板管理
- ✅ AI生成模板

**Phase 5**: 导出和主题
- ✅ 多格式导出
- ✅ 主题切换
- ✅ 历史对比

**Phase 6**: 错误处理和集成
- ✅ 统一错误处理
- ✅ 降级策略
- ✅ 问题类型识别
- ✅ 功能状态面板

### 2.3 错误处理和降级（重点测试）

| 场景 | 预期行为 | 优先级 |
|-----|---------|--------|
| API密钥无效 | 显示错误对话框，给出配置建议 | 🔴 P0 |
| 网络断开 | 显示网络错误，建议检查连接 | 🔴 P0 |
| AI对话初始化失败 | 跳过标签页，其他功能正常 | 🔴 P0 |
| 导出按钮初始化失败 | 降级为保存按钮 | 🟡 P1 |
| 主题设置失败 | 使用默认主题 | 🟢 P2 |

---

## 3. 测试方法

### 3.1 功能测试

**步骤**：
1. 启动应用
2. 按照测试清单逐项测试
3. 记录测试结果（通过/失败/部分通过）
4. 截图保存异常情况
5. 记录错误日志

**判定标准**：
- ✅ **通过**：功能正常，符合预期
- ⚠️ **部分通过**：功能基本可用，但有小问题
- ❌ **失败**：功能不可用或严重错误

### 3.2 性能测试

**测试指标**：
- 应用启动时间（<5秒）
- 分析响应时间（<30秒，取决于API速度）
- 历史记录加载时间（100条<2秒）
- UI响应流畅度（无明显卡顿）

**测试工具**：
- 秒表（手动计时）
- 任务管理器（观察内存占用）

### 3.3 兼容性测试

**浏览器**（如果有Web版）：
- Chrome 90+
- Firefox 88+
- Safari 14+

**操作系统**：
- Windows 10/11
- macOS 12+
- Ubuntu 20.04+

### 3.4 边界条件测试

**输入边界**：
- 空输入
- 超长输入（1000+字）
- 特殊字符（emoji、换行符）
- 无效日期（如2月30日）

**数据边界**：
- 0条历史记录
- 100+条历史记录
- 大型报告（10000+字）

---

## 4. 功能测试清单

### 4.1 应用启动和初始化

**测试步骤**：
```
□ 启动应用：python main.py
□ 检查主窗口正常显示
□ 检查4个标签页都存在：📊分析、💬AI对话、⚙️设置、📜历史记录
□ 检查日志文件创建：logs/cyber_mantic.log
□ 检查数据库创建：data/user/history.db
```

**预期结果**：
- 应用正常启动，无崩溃
- 所有标签页可见
- 如果未配置API，显示警告提示

**测试数据**：无

**优先级**：🔴 P0

---

### 4.2 基础分析功能

#### 4.2.1 阳历输入分析

**测试步骤**：
```
□ 切换到"📊 分析"标签页
□ 选择"阳历"
□ 输入出生日期：1990-05-20 15:30
□ 输入出生地点：北京市东城区
□ 选择问题类型：事业
□ 输入问题描述：我今年的工作运势如何？
□ 点击"开始分析"
□ 观察进度条和进度文字
□ 等待分析完成（约20-30秒）
□ 查看分析结果
```

**预期结果**：
- ✅ 进度条正常更新（0% → 100%）
- ✅ 进度文字根据问题类型显示（如"正在解析您的事业格局..."）
- ✅ 分析完成后显示完整报告
- ✅ 报告包含：八字信息、理论分析、综合建议

**判定标准**：
- 进度显示正常：✅ 通过
- 报告内容完整：✅ 通过
- 有任何错误：❌ 失败

**优先级**：🔴 P0

---

#### 4.2.2 农历输入分析

**测试步骤**：
```
□ 选择"农历"
□ 输入农历日期：1990年4月26日 未时
□ 勾选/取消"闰月"（根据实际）
□ 其他步骤同4.2.1
```

**预期结果**：
- ✅ 农历转阳历正确
- ✅ 分析结果正常

**优先级**：🔴 P0

---

#### 4.2.3 多理论综合分析

**测试步骤**：
```
□ 勾选多个理论：八字 + 奇门遁甲 + 六壬
□ 完成分析
□ 检查报告是否包含所有勾选理论的分析结果
```

**预期结果**：
- ✅ 报告包含所有理论的分析
- ✅ 有理论冲突时显示解决策略

**优先级**：🔴 P0

---

### 4.3 AI对话功能（重点测试）

#### 4.3.1 完整9步对话流程

**测试步骤**：
```
□ 切换到"💬 AI对话"标签页
□ 在输入框输入：我是1990年5月20日下午3点半出生的，想问问今年的工作运势
□ 点击"发送"
□ 观察9步交互过程：

  步骤1: 用户输入
  □ 检查消息显示在左侧（用户消息）

  步骤2: AI确认时间信息
  □ 检查AI返回解析的出生时间
  □ 右侧边栏显示八字信息

  步骤3: 八字分析
  □ 进度显示：正在排八字...
  □ AI返回八字分析结果

  步骤4: 奇门分析
  □ 进度显示：正在起奇门局...
  □ AI返回奇门分析

  步骤5: 六壬分析
  □ 进度显示：正在起六壬课...
  □ AI返回六壬分析

  步骤6: 综合分析
  □ AI返回综合结论和建议

  步骤7: 补充占卜（如有需要）
  □ AI可能要求补充信息

  步骤8: 反馈确认
  □ AI提出确认问题
  □ 用户回答"是"或"否"

  步骤9: 问答交互
  □ 用户可以继续提问
  □ AI基于前面分析回答

□ 测试保存对话功能：
  □ 点击"保存对话"按钮
  □ 检查弹出成功提示
```

**预期结果**：
- ✅ 9步流程完整执行
- ✅ 每步进度正确显示
- ✅ AI回复内容相关且完整
- ✅ 右侧边栏实时更新关键信息
- ✅ 保存对话成功

**测试用例**：
| 问题类型 | 测试问题 |
|---------|---------|
| 事业 | 我1990年5月20日出生，想问今年工作运势 |
| 财运 | 我1985年3月15日出生，最近适合投资吗 |
| 感情 | 我1992年10月8日出生，想问感情运势 |

**判定标准**：
- 所有9步都执行：✅ 通过
- 任何步骤出错：❌ 失败
- 保存功能正常：✅ 通过

**优先级**：🔴 P0

---

#### 4.3.2 AI对话保存和问题分类

**测试步骤**：
```
□ 完成一次AI对话
□ 点击"保存对话"
□ 切换到"📜 历史记录"标签页
□ 检查最新一条记录：
  □ 问题类型列显示正确（如"事业"而非"综合运势"）
  □ 问题描述显示正确
  □ 使用理论显示正确
```

**预期结果**：
- ✅ 问题类型智能识别正确（基于question_classifier.py）
- ✅ 保存的数据完整

**测试用例**：
| 输入问题 | 预期分类 |
|---------|---------|
| 我想问问今年的工作运势 | 事业 |
| 最近财运如何，适合投资吗 | 财运 |
| 我和她的感情会有结果吗 | 感情 |
| 什么时候适合结婚 | 择时 |
| 该不该跳槽到新公司 | 决策 |
| 综合看看我的运势 | 综合运势 |

**优先级**：🔴 P0

---

#### 4.3.3 新对话功能

**测试步骤**：
```
□ 完成一次对话后
□ 点击"新对话"按钮
□ 检查：
  □ 对话历史清空
  □ 右侧边栏重置
  □ 可以开始新的对话
```

**预期结果**：
- ✅ 状态正确重置
- ✅ 可以开始新对话

**优先级**：🟡 P1

---

### 4.4 历史记录功能

#### 4.4.1 历史记录查看

**测试步骤**：
```
□ 完成至少3次分析（分别使用不同问题类型）
□ 切换到"📜 历史记录"标签页
□ 检查：
  □ 所有分析记录都显示
  □ 时间、问题类型、描述、理论都正确
  □ 最新记录在最上面
```

**预期结果**：
- ✅ 所有记录正确显示
- ✅ 排序正确（最新在上）

**优先级**：🔴 P0

---

#### 4.4.2 历史记录筛选

**测试步骤**：
```
□ 使用搜索框输入关键词（如"工作"）
□ 检查：只显示包含关键词的记录

□ 使用类型筛选（下拉框选择"事业"）
□ 检查：只显示事业类问题

□ 点击"刷新"按钮
□ 检查：恢复显示所有记录
```

**预期结果**：
- ✅ 搜索功能正常
- ✅ 类型筛选正常
- ✅ 刷新功能正常

**优先级**：🟡 P1

---

#### 4.4.3 历史记录操作

**测试步骤**：
```
□ 点击某条记录的"查看"按钮
□ 检查：
  □ 切换到"分析"标签页
  □ 显示完整报告

□ 点击"问答"按钮
□ 检查：
  □ 打开报告问答对话框
  □ 输入问题："为什么说我2024年财运好？"
  □ AI返回基于报告的回答

□ 点击"删除"按钮
□ 检查：
  □ 弹出确认对话框
  □ 点击"是"后记录被删除
  □ 历史记录列表更新
```

**预期结果**：
- ✅ 查看功能正常
- ✅ 问答功能正常，AI回答相关
- ✅ 删除功能正常（需二次确认）

**优先级**：🔴 P0

---

#### 4.4.4 历史记录对比

**测试步骤**：
```
□ 勾选2条历史记录的复选框
□ 检查："对比选中的报告"按钮启用，显示"(2/2)"
□ 点击"对比"按钮
□ 检查对比对话框：
  □ 左右两侧分别显示两份报告
  □ 下方显示AI对比分析
  □ 可以导出对比报告为Markdown

□ 测试边界：勾选1条或3条记录
□ 检查：对比按钮禁用，显示"(X/2)"
```

**预期结果**：
- ✅ 只能选择2条记录进行对比
- ✅ 对比界面清晰
- ✅ AI对比分析内容相关
- ✅ 导出功能正常

**优先级**：🟡 P1

---

### 4.5 导出功能

#### 4.5.1 JSON导出

**测试步骤**：
```
□ 完成一次分析
□ 点击"📄 导出JSON"
□ 选择保存位置
□ 检查保存的JSON文件：
  □ 文件可以正常打开
  □ JSON格式正确
  □ 包含完整报告数据
```

**预期结果**：
- ✅ JSON文件格式正确
- ✅ 数据完整

**测试工具**：JSON验证器或文本编辑器

**优先级**：🟡 P1

---

#### 4.5.2 PDF导出

**测试步骤**：
```
□ 点击"📕 导出PDF"
□ 勾选/取消"包含详细信息"
□ 保存文件
□ 检查PDF文件：
  □ 可以用PDF阅读器打开
  □ 内容完整、格式美观
  □ 中文显示正常（无乱码）
```

**预期结果**：
- ✅ PDF生成成功
- ✅ 格式美观，中文正常

**测试工具**：Adobe Reader或浏览器

**优先级**：🟡 P1

---

#### 4.5.3 Markdown导出

**测试步骤**：
```
□ 点击"📝 导出Markdown"
□ 保存文件
□ 检查Markdown文件：
  □ 用文本编辑器打开
  □ Markdown格式正确
  □ 用Markdown阅读器预览
  □ 标题、列表、表格格式正确
```

**预期结果**：
- ✅ Markdown格式正确
- ✅ 可以正常渲染

**测试工具**：Typora、VSCode或GitHub

**优先级**：🟡 P1

---

### 4.6 报告自定义功能

#### 4.6.1 自定义报告模板

**测试步骤**：
```
□ 切换到"⚙️ 设置"标签页
□ 点击"🎨 打开报告自定义"
□ 在左侧选择"新增自定义模板"
□ 填写：
  □ 模板名称：简化版报告
  □ 用户需求描述：我希望报告简短一些，只保留关键建议，去掉术语解释
□ 点击"✨ AI生成模板"
□ 等待AI生成（约10秒）
□ 检查右侧预览：
  □ 显示生成的prompt模板
  □ 包含用户要求的要点
□ 点击"💾 保存模板"
□ 检查模板列表更新
```

**预期结果**：
- ✅ AI生成的模板符合用户需求
- ✅ 模板保存成功
- ✅ 最多保存5个自定义模板（超过5个自动删除最旧的）

**优先级**：🟢 P2

---

#### 4.6.2 使用自定义模板

**测试步骤**：
```
□ 在报告自定义对话框中选择刚创建的模板
□ 点击"使用此模板"
□ 回到分析标签页
□ 进行一次分析
□ 检查生成的报告：
  □ 报告风格符合自定义模板要求
  □ 简短、重点突出（根据模板要求）
```

**预期结果**：
- ✅ 自定义模板生效
- ✅ 报告风格明显不同

**优先级**：🟢 P2

---

### 4.7 主题切换功能

#### 4.7.1 手动切换主题

**测试步骤**：
```
□ 切换到"⚙️ 设置"标签页
□ 在"🎨 主题设置"组中：

  □ 选择"☀️ 清雅白"
  □ 点击"💾 应用主题"
  □ 检查：界面变为浅色主题

  □ 选择"🌙 墨夜黑"
  □ 点击"💾 应用主题"
  □ 检查：界面变为深色主题

  □ 选择"🧘 禅意灰"
  □ 点击"💾 应用主题"
  □ 检查：界面变为灰色主题
```

**预期结果**：
- ✅ 3种主题都能正常切换
- ✅ 颜色、字体、布局正确
- ✅ 重启应用后主题保持

**优先级**：🟢 P2

---

#### 4.7.2 自动切换主题

**测试步骤**：
```
□ 勾选"⏰ 自动切换（白天/夜间）"
□ 点击"💾 应用主题"
□ 修改系统时间测试：
  □ 设置时间为 10:00（白天）→ 检查使用浅色主题
  □ 设置时间为 20:00（夜间）→ 检查使用深色主题
□ 恢复系统时间
```

**预期结果**：
- ✅ 白天（6:00-18:00）自动使用浅色主题
- ✅ 夜间（18:00-6:00）自动使用深色主题

**优先级**：🟢 P2

---

### 4.8 功能状态面板（新增）

#### 4.8.1 正常启动状态检查

**测试步骤**：
```
□ 启动应用
□ 切换到"⚙️ 设置"标签页
□ 查看"🔍 功能状态"面板
□ 检查8个功能项：
  □ 💬 AI对话功能
  □ 📊 报告导出
  □ 🎨 主题切换
  □ 📝 报告自定义
  □ 📈 历史记录对比
  □ 💡 报告问答
  □ 🔍 术语解释
  □ 🤖 AI分析服务

□ 检查所有功能状态：
  □ 显示"✅ 正常"（绿色背景）
  □ 或显示"❌ 不可用"（红色背景）
```

**预期结果**：
- ✅ 正常启动时所有功能显示"正常"
- ✅ 功能状态准确反映实际情况

**优先级**：🟢 P2

---

#### 4.8.2 降级场景状态检查

**测试步骤**：
```
□ 模拟AI对话标签页初始化失败（需要修改代码）
□ 重启应用
□ 检查功能状态面板：
  □ "💬 AI对话功能"显示"❌ 不可用"
  □ 其他功能仍显示"✅ 正常"

□ 点击"🔄 刷新状态"按钮
□ 检查状态更新
```

**预期结果**：
- ✅ 降级时对应功能显示"不可用"
- ✅ 其他功能不受影响
- ✅ 刷新功能正常

**测试难度**：⚠️ 需要模拟错误场景

**优先级**：🟢 P2

---

### 4.9 API配置和设置

#### 4.9.1 API密钥配置

**测试步骤**：
```
□ 切换到"⚙️ 设置"标签页
□ 在"AI API 配置"组：

  □ 点击"👁"按钮显示/隐藏密钥
  □ 检查：密钥显示切换正常

  □ 填写API密钥（至少一个）
  □ 选择主API（下拉框）
  □ 勾选/取消"启用双模型验证"
  □ 点击"💾 保存配置"

□ 检查：
  □ 弹出"配置已保存"提示
  □ 系统重新加载配置
```

**预期结果**：
- ✅ 密钥显示/隐藏功能正常
- ✅ 配置保存成功
- ✅ 需要至少一个API密钥才能保存

**优先级**：🔴 P0

---

## 5. 性能测试

### 5.1 启动性能

**测试步骤**：
```
□ 完全退出应用
□ 使用秒表计时
□ 运行：python main.py
□ 记录从启动到主窗口完全显示的时间
```

**性能指标**：
- ✅ 优秀：< 3秒
- ⚠️ 良好：3-5秒
- ❌ 需优化：> 5秒

**优先级**：🟡 P1

---

### 5.2 分析响应时间

**测试步骤**：
```
□ 完成一次标准分析（八字 + 奇门 + 六壬）
□ 记录从点击"开始分析"到结果显示的时间
```

**性能指标**：
- ✅ 优秀：< 20秒
- ⚠️ 良好：20-40秒
- ❌ 需优化：> 40秒（可能是API响应慢）

**注意**：时间主要取决于API响应速度

**优先级**：🟡 P1

---

### 5.3 历史记录加载性能

**测试步骤**：
```
□ 准备100条历史记录（可以重复创建）
□ 切换到"历史记录"标签页
□ 记录加载时间
□ 测试滚动流畅度
```

**性能指标**：
- ✅ 优秀：< 1秒，滚动流畅
- ⚠️ 良好：1-2秒，偶尔卡顿
- ❌ 需优化：> 2秒或明显卡顿

**优先级**：🟡 P1

---

### 5.4 内存占用

**测试步骤**：
```
□ 打开任务管理器（Windows）或活动监视器（macOS）
□ 启动应用，记录初始内存占用
□ 执行10次分析
□ 记录内存占用
□ 执行100次分析（如果有耐心）
□ 检查内存是否持续增长（内存泄漏）
```

**性能指标**：
- ✅ 优秀：< 200MB，稳定
- ⚠️ 良好：200-500MB，略有增长
- ❌ 需优化：> 500MB或持续增长

**优先级**：🟡 P1

---

## 6. 异常场景测试

### 6.1 网络异常

#### 6.1.1 无网络连接

**测试步骤**：
```
□ 断开网络连接
□ 启动应用
□ 尝试进行分析
□ 检查：
  □ 是否显示网络错误对话框
  □ 错误建议是否包含"检查网络连接"
  □ 应用是否崩溃
```

**预期结果**：
- ✅ 显示友好错误提示
- ✅ 给出网络检查建议
- ✅ 应用不崩溃

**优先级**：🔴 P0

---

#### 6.1.2 API服务器响应慢

**测试步骤**：
```
□ 在网络不佳环境下测试
□ 进行分析
□ 检查：
  □ 是否超过2分钟显示超时提醒
  □ 提醒对话框内容是否合理
  □ 操作仍可继续
```

**预期结果**：
- ✅ 120秒后显示超时提醒
- ✅ 提示内容友好
- ✅ 操作可继续（提醒不中断）

**优先级**：🟡 P1

---

### 6.2 API密钥异常

#### 6.2.1 无效API密钥

**测试步骤**：
```
□ 在设置中填写无效的API密钥
□ 保存配置
□ 尝试进行分析
□ 检查：
  □ 显示API错误对话框
  □ 建议中包含"前往设置验证密钥"
  □ 建议切换到其他API
```

**预期结果**：
- ✅ 错误提示明确
- ✅ 给出具体操作建议
- ✅ 应用不崩溃

**优先级**：🔴 P0

---

#### 6.2.2 API配额耗尽

**测试步骤**：
```
□ 使用配额已耗尽的API密钥
□ 尝试分析
□ 检查：
  □ 错误提示是否明确
  □ 是否建议切换到其他API
  □ 故障转移是否自动工作
```

**预期结果**：
- ✅ 提示配额问题
- ✅ 自动尝试其他配置的API
- ✅ 或提示用户手动切换

**优先级**：🔴 P0

---

### 6.3 输入异常

#### 6.3.1 空输入

**测试步骤**：
```
□ 不填写任何信息
□ 直接点击"开始分析"
□ 检查：
  □ 是否显示输入验证提示
  □ 提示哪些字段必填
```

**预期结果**：
- ✅ 显示友好提示
- ✅ 指出缺少的必填项

**优先级**：🔴 P0

---

#### 6.3.2 无效日期

**测试步骤**：
```
□ 输入无效日期：2024-02-30
□ 尝试分析
□ 检查：
  □ 是否显示日期验证错误
  □ 建议正确的日期格式
```

**预期结果**：
- ✅ 验证日期合法性
- ✅ 给出明确提示

**优先级**：🔴 P0

---

#### 6.3.3 超长输入

**测试步骤**：
```
□ 在问题描述中输入2000+字的长文本
□ 尝试分析
□ 检查：
  □ 是否能正常处理
  □ 或者显示长度限制提示
```

**预期结果**：
- ✅ 能处理或给出长度限制

**优先级**：🟡 P1

---

### 6.4 数据库异常

#### 6.4.1 数据库文件损坏

**测试步骤**：
```
□ 手动删除或损坏 data/user/history.db
□ 启动应用
□ 检查：
  □ 是否自动重建数据库
  □ 或显示友好错误提示
  □ 应用是否崩溃
```

**预期结果**：
- ✅ 自动重建数据库
- ✅ 应用不崩溃

**优先级**：🟡 P1

---

#### 6.4.2 磁盘空间不足

**测试步骤**：
```
□ 在磁盘空间极少的环境测试
□ 尝试保存报告
□ 检查：
  □ 显示磁盘空间不足错误
  □ 建议清理磁盘空间
```

**预期结果**：
- ✅ 友好错误提示
- ✅ 操作建议明确

**测试难度**：⚠️ 需要特殊环境

**优先级**：🟢 P2

---

### 6.5 降级场景测试

#### 6.5.1 AI对话标签页初始化失败

**模拟方法**（需修改代码）：
```python
# 在main_window.py中临时添加
def _init_ui(self):
    # ...
    try:
        # 强制抛出异常测试降级
        raise Exception("Test AI conversation tab failure")
        self.ai_conversation_tab = AIConversationTab(...)
    except Exception as e:
        self.error_handler.handle_error(e, "AI对话标签页初始化", show_dialog=False)
```

**测试步骤**：
```
□ 修改代码模拟初始化失败
□ 启动应用
□ 检查：
  □ "💬 AI对话"标签页不存在
  □ 其他标签页正常工作
  □ 功能状态面板显示"AI对话功能: ❌ 不可用"
  □ 日志中记录警告信息
```

**预期结果**：
- ✅ 优雅降级，不影响其他功能
- ✅ 状态面板正确显示
- ✅ 应用不崩溃

**优先级**：🔴 P0

---

#### 6.5.2 导出按钮初始化失败

**测试步骤**：
```
□ 模拟ExportMenuButton初始化失败
□ 启动应用
□ 检查：
  □ 分析标签页有"保存报告"按钮（降级按钮）
  □ 点击保存按钮能保存JSON文件
  □ 其他功能正常
```

**预期结果**：
- ✅ 降级到保存按钮
- ✅ 基本功能保留

**优先级**：🟡 P1

---

## 7. 测试报告模板

### 7.1 测试环境信息

```
测试人员：________
测试时间：2025-__-__ 至 2025-__-__
测试版本：Phase 6集成版本 (commit: ________)

环境信息：
- 操作系统：Windows 11 / macOS 14 / Ubuntu 22.04
- Python版本：3.10.__ / 3.11.__ / 3.12.__
- 依赖版本：requirements.txt
- API配置：Claude ✅ / Deepseek ✅ / Gemini ⬜ / Kimi ⬜
```

### 7.2 测试结果汇总

```
功能测试结果统计：
- 总测试项：__ 项
- 通过：__ 项 (✅)
- 部分通过：__ 项 (⚠️)
- 失败：__ 项 (❌)
- 未测试：__ 项 (⬜)

通过率：___%

优先级统计：
- P0 (关键功能)：通过 __/__ 项
- P1 (重要功能)：通过 __/__ 项
- P2 (次要功能)：通过 __/__ 项
```

### 7.3 详细测试结果

| 测试项 | 优先级 | 状态 | 备注/问题描述 |
|-------|--------|------|--------------|
| 4.1 应用启动 | P0 | ✅/⚠️/❌ | |
| 4.2.1 阳历分析 | P0 | ✅/⚠️/❌ | |
| 4.3.1 AI对话 | P0 | ✅/⚠️/❌ | |
| ... | ... | ... | ... |

### 7.4 发现的问题清单

**高优先级问题 (Blocker)**：
```
1. [BUG-001] 标题：网络断开时应用崩溃
   重现步骤：1. 断开网络 2. 点击开始分析
   预期结果：显示友好错误提示
   实际结果：应用崩溃退出
   严重程度：高 🔴
   截图：bug-001.png
   日志：[2025-12-31 10:23:45] ERROR: ...
```

**中优先级问题 (Major)**：
```
2. [BUG-002] 标题：历史记录加载缓慢
   重现步骤：1. 创建100条记录 2. 切换到历史标签页
   预期结果：<2秒加载
   实际结果：需要5秒，有卡顿
   严重程度：中 🟡
```

**低优先级问题 (Minor)**：
```
3. [BUG-003] 标题：主题切换后需要重启
   重现步骤：1. 切换主题 2. 检查效果
   预期结果：立即生效
   实际结果：部分控件未更新，需重启
   严重程度：低 🟢
```

### 7.5 性能测试结果

```
性能指标：
- 应用启动时间：__ 秒 (目标: <5秒)
- 分析响应时间：__ 秒 (目标: <30秒)
- 历史记录加载(100条)：__ 秒 (目标: <2秒)
- 初始内存占用：__ MB
- 运行后内存占用：__ MB (执行10次分析后)
- 内存泄漏检测：有/无
```

### 7.6 兼容性测试结果

```
操作系统兼容性：
- Windows 10：✅/⚠️/❌/⬜
- Windows 11：✅/⚠️/❌/⬜
- macOS 12+：✅/⚠️/❌/⬜
- Ubuntu 20.04+：✅/⚠️/❌/⬜

Python版本兼容性：
- Python 3.10：✅/⚠️/❌/⬜
- Python 3.11：✅/⚠️/❌/⬜
- Python 3.12：✅/⚠️/❌/⬜
```

### 7.7 测试建议和总结

```
总体评价：
- 功能完整性：优秀/良好/一般/较差
- 稳定性：优秀/良好/一般/较差
- 性能：优秀/良好/一般/较差
- 用户体验：优秀/良好/一般/较差

建议：
1. 优先修复高优先级问题（Blocker）
2. ...
3. ...

测试结论：
✅ 建议发布 / ⚠️ 修复问题后发布 / ❌ 不建议发布
```

---

## 8. 附录

### 8.1 常见问题FAQ

**Q1: 分析过程中出现"API调用失败"怎么办？**
A:
1. 检查网络连接
2. 前往设置验证API密钥是否正确
3. 检查API账户是否有足够配额
4. 尝试切换到其他API

**Q2: 历史记录无法加载？**
A:
1. 检查数据库文件是否存在：data/user/history.db
2. 查看日志文件：logs/cyber_mantic.log
3. 尝试重启应用
4. 如果仍有问题，删除数据库文件重建

**Q3: 导出PDF时中文乱码？**
A:
1. 检查系统是否安装中文字体
2. 查看日志中的字体相关错误
3. 联系开发者报告问题

### 8.2 日志分析技巧

**查找错误**：
```bash
grep "ERROR" logs/cyber_mantic.log
grep "CRITICAL" logs/cyber_mantic.log
```

**查看最近日志**：
```bash
tail -100 logs/cyber_mantic.log
```

**按时间筛选**：
```bash
grep "2025-12-31 10:" logs/cyber_mantic.log
```

### 8.3 测试截图规范

**截图命名**：
- 功能截图：`功能名称_步骤.png`（如`ai_conversation_step3.png`）
- Bug截图：`bug-编号_描述.png`（如`bug-001_crash.png`）

**截图内容**：
- 包含完整应用窗口
- 必要时标注关键区域（使用箭头或方框）
- 包含时间戳（如果相关）

### 8.4 测试数据清理

**清理历史记录**：
```bash
# 删除数据库文件
rm data/user/history.db

# 或使用GUI的删除功能
```

**清理日志**：
```bash
rm logs/cyber_mantic.log
```

**重置配置**：
```bash
rm data/user/user_config.yaml
```

---

## 9. 测试提交

### 9.1 测试完成后

```
□ 填写完整的测试报告
□ 整理所有测试截图
□ 收集相关日志文件
□ 总结发现的问题
□ 提出改进建议
```

### 9.2 提交方式

**选项1: GitHub Issue**
```
在项目仓库创建Issue：
- 标题：[测试报告] Phase 6功能测试
- 内容：粘贴测试报告
- 附件：截图和日志
```

**选项2: 文档分享**
```
将测试报告保存为Markdown或PDF：
- TESTING_REPORT_2025-12-31.md
- 分享给开发团队
```

---

## 10. 联系方式

**遇到问题？**
- GitHub Issues: https://github.com/your-repo/issues
- 邮件：support@example.com
- 附上日志文件：logs/cyber_mantic.log

**测试反馈**：
- 所有测试问题都应记录在测试报告中
- 高优先级问题应立即报告
- 建议附上复现步骤和截图

---

**测试愉快！感谢您的贡献！** 🎉
