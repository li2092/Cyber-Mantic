# PyQt6 前端重构方案

> 基于 Demo 现代设计风格，重构现有 PyQt6 前端界面

---

## 一、品牌视觉系统

### 1.0 Logo 与品牌标识

#### Logo 文件

| 文件 | 用途 | 位置 |
|------|------|------|
| `app_icon.png` | 窗口图标、任务栏、托盘 | `ui/resources/` |
| `app_logo_full.png` | 关于页面、启动画面 | `ui/resources/` |

#### Logo 配色提取

```
┌────────────────────────────────────────────────────────────┐
│                    LOGO 色彩分析                           │
│                                                            │
│   ┌──────────┐                                             │
│   │  ☯ 赛博  │   深邃蓝底: #0a2540 ~ #1a3a5c              │
│   │    玄数  │   电路纹路: #06b6d4 (青蓝)                  │
│   └──────────┘   金色指针: #d4af37 ~ #f59e0b              │
│                  紫色星芒: #8b5cf6 ~ #6366f1              │
│                  金色文字: #d4af37                        │
└────────────────────────────────────────────────────────────┘
```

#### 品牌色彩对应

| Logo 元素 | 提取色值 | 对应设计色 | 用途 |
|----------|---------|-----------|------|
| 紫色星芒 | `#8b5cf6` | `#6366f1` 主强调色 | 按钮、选中态、链接 |
| 金色指针 | `#d4af37` | `#f59e0b` 辅强调色 | 警示、重点、徽章 |
| 电路纹路 | `#06b6d4` | `#06b6d4` 科技色 | 图表、进度、装饰 |
| 深邃蓝底 | `#0a2540` | `#0f0f1a` 主背景 | 深色主题背景 |

#### 侧边栏 Logo 展示规范

```
┌─────────────────────────────────┐
│  ┌────────┐                    │
│  │  LOGO  │  赛博玄数          │  ← 48x48 圆形图标
│  │ 48x48  │  CYBER MANTIC      │  ← 主标题 20px 粗体
│  └────────┘  ─────────────     │  ← 副标题 10px 灰色
│                                │
│  间距: 图标与文字 12px         │
│  左右边距: 20px                │
│  上下边距: 20px                │
└─────────────────────────────────┘
```

---

### 1.1 双主题配色方案

#### 主题一：墨夜黑（Dark Theme）

| 属性 | 值 | 说明 |
|------|-----|------|
| **主背景色** | `#0f0f1a` | 深邃夜空色 |
| **次背景色** | `#1a1a2e` | 侧边栏、卡片底色 |
| **卡片背景** | `rgba(30, 30, 50, 0.6)` | 毛玻璃效果 |
| **主强调色** | `#6366f1` | 玄青紫 - Logo星芒 |
| **辅强调色** | `#f59e0b` | 丹朱橙 - Logo金针 |
| **科技色** | `#06b6d4` | 青蓝 - Logo电路 |
| **成功色** | `#10b981` | 翠绿 |
| **警告色** | `#ef4444` | 朱红 |
| **主文字** | `#f1f5f9` | 月白色 |
| **次文字** | `#94a3b8` | 银灰色 |
| **弱文字** | `#64748b` | 暗灰色 |
| **边框色** | `rgba(255,255,255,0.08)` | 微光边框 |
| **输入框背景** | `#252542` | 深紫灰 |
| **悬停背景** | `rgba(99,102,241,0.1)` | 淡紫光 |

#### 主题二：清雅白（Light Theme）

| 属性 | 值 | 说明 |
|------|-----|------|
| **主背景色** | `#f8fafc` | 云白色 |
| **次背景色** | `#f1f5f9` | 侧边栏、卡片底色 |
| **卡片背景** | `rgba(255, 255, 255, 0.8)` | 白色毛玻璃 |
| **主强调色** | `#6366f1` | 玄青紫 - Logo星芒 |
| **辅强调色** | `#f59e0b` | 丹朱橙 - Logo金针 |
| **科技色** | `#0891b2` | 青蓝(加深) - Logo电路 |
| **成功色** | `#10b981` | 翠绿（保持） |
| **警告色** | `#ef4444` | 朱红（保持） |
| **主文字** | `#1e293b` | 墨玄色 |
| **次文字** | `#64748b` | 灰青色 |
| **弱文字** | `#94a3b8` | 淡灰色 |
| **边框色** | `rgba(0,0,0,0.08)` | 淡墨边框 |
| **输入框背景** | `#ffffff` | 纯白 |
| **悬停背景** | `rgba(99,102,241,0.08)` | 淡紫光 |
| **阴影** | `rgba(0,0,0,0.1)` | 柔和阴影 |

### 1.2 通用设计规范

| 属性 | 值 | 说明 |
|------|-----|------|
| **圆角** | `16px / 12px / 10px / 8px` | 大/中/小/微 |
| **字体** | Microsoft YaHei, Noto Serif SC | 界面/标题 |
| **间距** | `32px / 24px / 16px / 12px / 8px` | XXL/XL/L/M/S |
| **动画时长** | `150ms / 250ms / 400ms` | 快/中/慢 |

### 1.3 主题切换效果对比

```
┌─────────────────────────────────────────────────────────────────┐
│                     墨夜黑 (Dark)                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  背景: #0f0f1a                                          │   │
│  │  ┌─────────────┐  文字: #f1f5f9 (白)                   │   │
│  │  │ 卡片        │  强调: #6366f1 (紫)                   │   │
│  │  │ #1a1a2e     │  边框: 白色 8% 透明度                 │   │
│  │  └─────────────┘                                        │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                     清雅白 (Light)                              │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  背景: #f8fafc                                          │   │
│  │  ┌─────────────┐  文字: #1e293b (黑)                   │   │
│  │  │ 卡片        │  强调: #6366f1 (紫) - 保持一致        │   │
│  │  │ #ffffff     │  边框: 黑色 8% 透明度                 │   │
│  │  │ + 阴影      │  阴影: 柔和投影                       │   │
│  │  └─────────────┘                                        │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

### 1.4 组件库（需新建）

```
cyber_mantic/ui/components/
├── __init__.py
├── base.py              # 基础样式常量
├── glass_card.py        # 毛玻璃卡片
├── nav_button.py        # 导航按钮
├── stat_card.py         # 统计卡片
├── chat_bubble.py       # 聊天气泡（新）
├── bazi_pillar.py       # 八字柱位
├── wuxing_indicator.py  # 五行指示器
├── quick_action.py      # 快捷操作按钮
├── progress_bar.py      # 进度条（新样式）
├── input_field.py       # 输入框
├── button.py            # 按钮（Primary/Secondary）
└── sidebar.py           # 侧边栏组件
```

---

## 二、现有功能清单

### 2.1 六大标签页功能

| Tab | 现有功能 | 后端依赖 |
|-----|---------|---------|
| **问道** | 5阶段AI对话、聊天气泡、八字命盘显示、进度追踪、保存对话 | ConversationService |
| **推演** | 输入面板、理论选择、进度显示、结果4Tab（摘要/详细/理论/可视化）、导出 | AnalysisService |
| **典籍** | 文档树、Markdown渲染、笔记系统、AI学习助手、RAG问答、阅读计时 | NotesManager, RAGManager |
| **洞察** | 使用画像、学习统计、状态评估、预警机制、AI深度分析 | UsageStatsManager |
| **历史** | 表格列表、搜索过滤、报告对比、删除管理 | HistoryManager |
| **设置** | 功能状态、主题切换、API配置、报告自定义、帮助说明 | ConfigManager, ThemeManager |

### 2.2 现有 Widgets

| Widget | 位置 | 功能 | 重构策略 |
|--------|------|------|---------|
| ChatWidget | `widgets/chat_widget.py` | 聊天消息显示 | **重写** - 使用新气泡样式 |
| ProgressWidget | `widgets/progress_widget.py` | 进度显示 | **重写** - 新进度条样式 |
| DocumentViewer | `widgets/document_viewer.py` | Markdown渲染 | **保留** - 仅更新样式 |
| FeatureStatusWidget | `widgets/feature_status_widget.py` | 功能状态卡片 | **重写** - 使用StatCard |
| ThemeSettingsWidget | `widgets/theme_settings_widget.py` | 主题选择 | **重写** - 新卡片样式 |
| ExportMenuButton | `widgets/export_menu_button.py` | 导出菜单 | **保留** - 更新样式 |
| HelpWidget | `widgets/help_widget.py` | 帮助说明 | **保留** - 更新样式 |

---

## 三、重构架构

### 3.1 新目录结构

```
cyber_mantic/ui/
├── components/           # 【新】可复用组件库
│   ├── __init__.py
│   ├── styles.py        # 全局样式表
│   ├── glass_card.py
│   ├── nav_button.py
│   ├── stat_card.py
│   ├── chat_bubble.py
│   ├── bazi_display.py  # 八字命盘组件
│   ├── wuxing_chart.py  # 五行图表
│   ├── quick_action.py
│   └── inputs.py        # 输入控件
│
├── layouts/              # 【新】布局组件
│   ├── __init__.py
│   ├── sidebar.py       # 侧边栏
│   ├── topbar.py        # 顶部栏
│   └── content_area.py  # 内容区容器
│
├── pages/                # 【重命名】原 tabs → pages
│   ├── __init__.py
│   ├── wendao_page.py   # 问道（原 ai_conversation_tab）
│   ├── tuiyan_page.py   # 推演（原 analysis_tab）
│   ├── dianji_page.py   # 典籍（原 library_tab）
│   ├── dongcha_page.py  # 洞察（原 insight_tab）
│   ├── lishi_page.py    # 历史（原 history_tab）
│   └── shezhi_page.py   # 设置（原 settings_tab）
│
├── dialogs/              # 保留
├── main_window.py        # 重写
└── __init__.py
```

### 3.2 新主窗口布局

```
┌─────────────────────────────────────────────────────────────────┐
│                         MainWindow                              │
├─────────────┬───────────────────────────────────────────────────┤
│             │                  TopBar                           │
│             │  [页面标题]              [搜索] [通知] [主题]     │
│   Sidebar   ├───────────────────────────────────────────────────┤
│             │                                                   │
│  ☯ 赛博玄数 │              ContentArea (QStackedWidget)        │
│  ─────────  │                                                   │
│  💬 问道    │     ┌─────────────────────────────────────┐      │
│  🔮 推演    │     │                                     │      │
│  📚 典籍    │     │         当前页面内容                │      │
│  ─────────  │     │                                     │      │
│  💡 洞察    │     │                                     │      │
│  📜 历史    │     │                                     │      │
│  ─────────  │     └─────────────────────────────────────┘      │
│  ⚙️ 设置    │                                                   │
│             │                                                   │
│  [用户卡片] │                                                   │
└─────────────┴───────────────────────────────────────────────────┘
```

---

## 四、页面重构详情

### 4.1 问道页面 (WendaoPage)

**布局**：左右分栏（6:4）

```
┌────────────────────────────────┬──────────────────────┐
│          对话区                │      信息面板        │
│  ┌────────────────────────┐   │  ┌────────────────┐  │
│  │    ChatBubble(AI)      │   │  │   八字命盘     │  │
│  └────────────────────────┘   │  │  ┌──┬──┬──┬──┐ │  │
│  ┌────────────────────────┐   │  │  │年│月│日│时│ │  │
│  │    ChatBubble(User)    │   │  │  │柱│柱│柱│柱│ │  │
│  └────────────────────────┘   │  │  └──┴──┴──┴──┘ │  │
│  ┌────────────────────────┐   │  └────────────────┘  │
│  │    ChatBubble(AI)      │   │  ┌────────────────┐  │
│  └────────────────────────┘   │  │   五行分布     │  │
│                               │  │  木 火 土 金 水 │  │
│  ┌──────────────────────┬──┐  │  └────────────────┘  │
│  │    输入框            │➤│  │  ┌────────────────┐  │
│  └──────────────────────┴──┘  │  │   快捷操作     │  │
│  [保存对话]  [新对话]         │  │ 🎲小六壬 ✍️测字│  │
└────────────────────────────────┴──┴────────────────┴──┘
```

**组件映射**：
| 现有 | 新组件 |
|------|--------|
| ChatWidget | ChatBubble (多个) + ScrollArea |
| 右侧八字显示 | BaziDisplay + WuxingChart |
| 快捷操作区 | QuickAction (网格) |

### 4.2 推演页面 (TuiyanPage)

**布局**：上中下三段

```
┌─────────────────────────────────────────────────────────┐
│  欢迎横幅 (WelcomeBanner)                               │
│  "欢迎回来，xxx"  [开始推演] [查看运势]                 │
├─────────────────────────────────────────────────────────┤
│  统计卡片区 (4个 StatCard)                              │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐   │
│  │本月分析  │ │学习时长  │ │笔记数量  │ │准确率    │   │
│  │  128     │ │  24.5h   │ │  56      │ │  87%     │   │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘   │
├─────────────────────────────────────────────────────────┤
│  主内容区                                               │
│  ┌─────────────────────────┐ ┌─────────────────────┐   │
│  │     输入面板 (左)       │ │   结果面板 (右)     │   │
│  │  • 出生时间             │ │  • 执行摘要         │   │
│  │  • 问题描述             │ │  • 详细分析         │   │
│  │  • 理论选择             │ │  • 理论列表         │   │
│  │  • 随机数字             │ │  • 可视化图表       │   │
│  └─────────────────────────┘ └─────────────────────┘   │
├─────────────────────────────────────────────────────────┤
│  底部按钮: [开始分析]  [导出报告]                       │
└─────────────────────────────────────────────────────────┘
```

**组件映射**：
| 现有 | 新组件 |
|------|--------|
| InputPanel | GlassCard + 新样式输入控件 |
| ProgressPanel | 新进度条组件 |
| ResultPanel | GlassCard + QTabWidget(新样式) |

### 4.3 典籍页面 (DianjiPage)

**布局**：左右分栏（3:7）

```
┌──────────────┬──────────────────────────────────────────┐
│   文档树     │              文档内容                    │
│  ┌────────┐  │  ┌────────────────────────────────────┐  │
│  │📁系统  │  │  │                                    │  │
│  │ └📄八字│  │  │     Markdown 渲染内容              │  │
│  │ └📄紫微│  │  │                                    │  │
│  │📁用户  │  │  │                                    │  │
│  │ └📄笔记│  │  └────────────────────────────────────┘  │
│  └────────┘  │  ┌────────────────────────────────────┐  │
│              │  │  AI学习助手工具栏                  │  │
│  [导入文档]  │  │  [总结] [洞察] [方案] [心得] [问答]│  │
│  [知识问答]  │  └────────────────────────────────────┘  │
└──────────────┴──────────────────────────────────────────┘
```

### 4.4 洞察页面 (DongchaPage)

**布局**：卡片网格

```
┌─────────────────────────────────────────────────────────┐
│  使用画像卡片                                           │
│  ┌──────────────────────────────────────────────────┐   │
│  │ 📊 使用频率: 高频  | 常用时段: 晚间              │   │
│  │ 🔮 偏好理论: 八字、紫微  | 关注话题: 事业、感情  │   │
│  └──────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────┤
│  统计卡片区 (4个)                                       │
│  本周问道 | 本周推演 | 阅读时长 | 笔记数量              │
├─────────────────────────────────────────────────────────┤
│  状态评估卡片                                           │
│  ┌──────────────────────────────────────────────────┐   │
│  │ 当前状态: 🟢 正常                                │   │
│  │ • 使用频率适中  • 无异常模式检测                 │   │
│  └──────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────┤
│  AI深度分析 (≥5次使用后解锁)                           │
│  [生成个性化分析]                                       │
└─────────────────────────────────────────────────────────┘
```

### 4.5 历史页面 (LishiPage)

**布局**：工具栏 + 表格

```
┌─────────────────────────────────────────────────────────┐
│  工具栏                                                 │
│  [刷新] [清空] [对比(0/2)]  搜索:[__________] 筛选:[v] │
├─────────────────────────────────────────────────────────┤
│  历史记录表格 (GlassCard 样式)                          │
│  ┌─────┬────────────┬──────────┬──────────┬─────────┐  │
│  │ □  │ 时间       │ 问题摘要 │ 理论     │ 操作    │  │
│  ├─────┼────────────┼──────────┼──────────┼─────────┤  │
│  │ □  │ 2025-01-06 │ 事业运势 │ 八字     │ [查看]  │  │
│  │ □  │ 2025-01-05 │ 感情咨询 │ 紫微     │ [查看]  │  │
│  └─────┴────────────┴──────────┴──────────┴─────────┘  │
└─────────────────────────────────────────────────────────┘
```

### 4.6 设置页面 (ShezhiPage)

**布局**：卡片列表

```
┌─────────────────────────────────────────────────────────┐
│  功能状态卡片                                           │
│  ┌──────────────────────────────────────────────────┐   │
│  │ ✅ AI对话  ✅ 报告导出  ✅ 主题切换  ✅ 历史对比 │   │
│  │ 可用: 8/8  [刷新状态]                            │   │
│  └──────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────┤
│  主题设置卡片                                           │
│  ┌──────────────────────────────────────────────────┐   │
│  │ 🎨 当前主题: 墨夜黑                              │   │
│  │ [清雅白] [墨夜黑] [禅意灰]                       │   │
│  └──────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────┤
│  API 配置卡片                                           │
│  ┌──────────────────────────────────────────────────┐   │
│  │ Claude API: [_______________] [测试]             │   │
│  │ Gemini API: [_______________] [测试]             │   │
│  │ DeepSeek:   [_______________] [测试]             │   │
│  │ Kimi:       [_______________] [测试]             │   │
│  │                               [保存配置]         │   │
│  └──────────────────────────────────────────────────┘   │
├─────────────────────────────────────────────────────────┤
│  关于产品 / 帮助说明                                    │
└─────────────────────────────────────────────────────────┘
```

---

## 五、实施计划

### 阶段 1：基础组件库（2-3天）

| 任务 | 文件 | 说明 |
|------|------|------|
| 1.1 | `components/styles.py` | 全局样式表（颜色、字体、圆角等） |
| 1.2 | `components/glass_card.py` | 毛玻璃卡片组件 |
| 1.3 | `components/nav_button.py` | 导航按钮 |
| 1.4 | `components/stat_card.py` | 统计卡片 |
| 1.5 | `components/chat_bubble.py` | 聊天气泡 |
| 1.6 | `components/bazi_display.py` | 八字命盘（柱位+五行） |
| 1.7 | `components/inputs.py` | 输入框、按钮、下拉框 |

### 阶段 2：布局组件（1-2天）

| 任务 | 文件 | 说明 |
|------|------|------|
| 2.1 | `layouts/sidebar.py` | 侧边栏（Logo+导航+用户卡片） |
| 2.2 | `layouts/topbar.py` | 顶部栏（标题+搜索+图标） |
| 2.3 | `main_window.py` | 新主窗口（侧边栏+内容区布局） |

### 阶段 3：页面重构（5-7天）

| 任务 | 文件 | 优先级 |
|------|------|--------|
| 3.1 | `pages/wendao_page.py` | **P0** - 核心交互 |
| 3.2 | `pages/tuiyan_page.py` | **P0** - 核心功能 |
| 3.3 | `pages/shezhi_page.py` | **P1** - 配置必需 |
| 3.4 | `pages/lishi_page.py` | **P1** - 数据查看 |
| 3.5 | `pages/dianji_page.py` | **P2** - 学习功能 |
| 3.6 | `pages/dongcha_page.py` | **P2** - 增值功能 |

### 阶段 4：集成测试（2-3天）

| 任务 | 说明 |
|------|------|
| 4.1 | 后端服务对接验证 |
| 4.2 | 信号槽连接测试 |
| 4.3 | 主题切换测试 |
| 4.4 | 数据流验证 |

---

## 六、关键注意事项

### 6.1 后端对接保持不变

所有后端服务接口保持不变：
- `ConversationService` - 问道对话
- `AnalysisService` - 推演分析
- `HistoryManager` - 历史记录
- `ConfigManager` - 配置管理
- `UsageStatsManager` - 使用统计
- `NotesManager` - 笔记管理
- `RAGManager` - 知识问答

### 6.2 信号槽机制保持

保持现有的信号槽连接：
```python
# 示例：分析完成信号
analysis_completed = pyqtSignal(object)  # 保持

# 示例：主题变更信号
theme_changed = pyqtSignal(str)  # 保持
```

### 6.3 渐进式替换

建议采用渐进式替换策略：
1. 先创建新组件库
2. 新建 `pages/` 目录，逐个重写页面
3. 在 `main_window.py` 中切换使用新页面
4. 验证无误后删除旧 `tabs/` 目录

---

## 七、预期效果

### 重构前
- 标准 PyQt6 默认样式
- QTabWidget 标签页切换
- 样式分散在各文件

### 重构后
- 现代毛玻璃设计风格
- 侧边栏导航 + 内容区切换
- 统一组件库 + 集中样式管理
- 视觉效果对标 Demo

---

## 附录：Demo 组件参考

Demo 文件位置：`/demo/desktop/main.py`

已实现的组件：
- `NavButton` - 导航按钮
- `GlassCard` - 毛玻璃卡片
- `StatCard` - 统计卡片
- `ChatBubble` - 聊天气泡
- `BaZiPillar` - 八字柱位
- `WuXingIndicator` - 五行指示器
- `QuickActionButton` - 快捷操作按钮

样式表：`STYLE_SHEET` 变量（约 400 行）
