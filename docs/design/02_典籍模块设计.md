# 典籍模块设计

> **版本**：v4.0
> **更新日期**：2026-01-05

---

## 1. 功能概述

典籍模块是术数学习平台，提供文档阅读、笔记摘抄、AI辅助学习功能。

---

## 2. 界面布局

```
┌─────────────────────────────────────────────────────────────┐
│ [典籍]                                          [导入资料]  │
├─────────────┬───────────────────────────────────────────────┤
│ 📁 资料分类  │  文档预览区                                   │
│             │  ┌─────────────────────────────────────────┐  │
│ ▼ 系统资料   │  │  [选中文本后浮出工具栏]                  │  │
│   ├─ 入门   │  │  📝添加笔记 │ 📋复制 │ 💬提问           │  │
│   ├─ 八字   │  │                                         │  │
│   ├─ 紫微   │  │  Markdown / Word / PDF 渲染              │  │
│   └─ ...    │  │                                         │  │
│             │  └─────────────────────────────────────────┘  │
│ ▼ 我的资料   │                                              │
│   └─ ...    │  ─────────── 我的笔记 ───────────             │
│             │  ┌─────────────────────────────────────────┐  │
│ ▼ 我的笔记   │  │ 📌 摘录内容 + 来源 + 笔记 + 标签          │  │
│   ├─ #八字   │  └─────────────────────────────────────────┘  │
│   └─ #紫微   │                                              │
├─────────────┴───────────────────────────────────────────────┤
│ 🤖 AI学习助手：[总结] [洞察] [学习方案] [心得生成] [自定义...]│
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 核心功能

### 3.1 文档阅读

| 功能 | 说明 |
|------|------|
| 格式支持 | Markdown > Word > PDF（优先级） |
| 渲染方式 | 内嵌预览，支持目录导航 |
| 资料分类 | 系统资料（只读）+ 用户资料（可增删） |

### 3.2 笔记摘抄

| 功能 | 说明 |
|------|------|
| 选中摘抄 | 选中文本 → 浮出工具栏 → 添加笔记 |
| 笔记内容 | 摘录原文 + 来源位置 + 用户笔记 + 标签 |
| 标签分类 | 支持自定义标签归类 |
| 存储方式 | SQLite统一数据库 `~/.xuanshu/notes.db` |
| 导出格式 | Markdown / PDF |

### 3.3 AI学习助手

| 功能 | 说明 |
|------|------|
| 总结 | 对选中内容或整篇文档生成摘要 |
| 洞察 | 提取关键知识点和深层含义 |
| 学习方案 | 根据内容生成学习路径建议 |
| 心得生成 | 基于笔记生成学习心得 |
| 自定义 | 用户输入Prompt自定义输出 |

---

## 4. 数据结构

### 4.1 笔记数据表

```sql
CREATE TABLE notes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    content TEXT NOT NULL,           -- 摘录原文
    source_file TEXT NOT NULL,       -- 来源文件路径
    source_position TEXT,            -- 来源位置（章节/页码）
    user_note TEXT,                  -- 用户笔记
    tags TEXT,                       -- 标签（JSON数组）
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE tags (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT UNIQUE NOT NULL,
    color TEXT DEFAULT '#666666'
);
```

### 4.2 资料存储路径

| 类型 | 路径 |
|------|------|
| 系统资料 | `安装目录/resources/library/` |
| 用户资料 | `~/.xuanshu/documents/` |
| 笔记数据库 | `~/.xuanshu/notes.db` |

---

## 5. RAG问答功能

### 5.1 实现方案

- **优先级**：P2（中）
- **合并开发**：与帮助模块RAG合并
- **索引范围**：系统资料 + 用户资料 + 笔记内容

### 5.2 交互方式

选中文本 → 点击「提问」→ 弹出对话框 → 基于文档上下文回答

---

## 6. 待开发任务

- [ ] 文档阅读器组件（Markdown/Word/PDF）
- [ ] 笔记系统（CRUD + 标签）
- [ ] AI学习助手接口
- [ ] RAG索引与检索（P2）
- [ ] 笔记导出功能
