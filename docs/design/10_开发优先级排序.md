# 开发优先级排序

> **版本**：v4.0
> **更新日期**：2026-01-05

---

## 1. 优先级总览

| 优先级 | 模块 | 工作量 | 依赖关系 |
|--------|------|--------|---------|
| **P0** | 免责声明系统 | 小 | 无 |
| **P0** | 标签页重构 | 中 | 无 |
| **P1** | Prompt管理迁移 | 中 | 无 |
| **P1** | 洞察模块-基础功能 | 中 | 标签页重构 |
| **P1** | AI接口优化 | 大 | 无 |
| **P2** | 洞察模块-预警机制 | 大 | 洞察基础 |
| **P2** | 典籍模块-文档阅读 | 大 | 标签页重构 |
| **P2** | 典籍模块-笔记系统 | 中 | 文档阅读 |
| **P2** | 帮助系统 | 中 | 无 |
| **P3** | 典籍模块-AI学习助手 | 中 | 笔记系统 |
| **P3** | RAG问答功能 | 大 | 典籍+帮助 |
| **P3** | 首次引导流程 | 小 | 标签页重构 |
| **P4** | 典籍内容生成 | 大 | 典籍模块 |
| **P4** | 文档输出（手册等） | 中 | 功能稳定后 |
| **P5** | 多语言支持 | 大 | 所有功能稳定 |

---

## 2. 阶段划分

### 阶段一：基础框架（P0）

**目标**：完成核心架构调整，确保合规性

| 任务 | 描述 | 预估复杂度 |
|------|------|-----------|
| 免责声明-首次启动 | 完整协议 + 语言选择界面 | ⭐⭐ |
| 免责声明-简版提示 | 问道/推演触发的简版提示 | ⭐ |
| 免责声明-未成年人检测 | 年龄检测 + 额外确认流程 | ⭐⭐ |
| 标签页重构 | 6标签页架构 + 命名更新 | ⭐⭐⭐ |
| 协议文档撰写 | 完整版免责声明 | ⭐⭐ |

**交付物**：
- 首次启动完整流程
- 6标签页框架（问道/推演/典籍/洞察/历史记录/设置）
- `docs/legal/disclaimer_zh_CN.md`

---

### 阶段二：核心增强（P1）

**目标**：Prompt管理优化、洞察基础、AI接口升级

| 任务 | 描述 | 预估复杂度 |
|------|------|-----------|
| Prompt迁移 | prompts.py → docs/prompts/*.md | ⭐⭐ |
| Prompt加载器 | 变量替换 + 缓存机制 | ⭐⭐ |
| A/B测试机制 | 变体配置 + 设置界面 | ⭐⭐⭐ |
| 洞察-使用统计 | 基础数据收集与展示 | ⭐⭐ |
| 洞察-画像数据库 | profile.db 设计与实现 | ⭐⭐ |
| AI接口-自定义接口 | OpenAI兼容接口添加 | ⭐⭐⭐ |
| AI接口-接口分配 | 6类功能分配配置 | ⭐⭐ |
| AI接口-故障转移 | 自动切换 + 降级机制 | ⭐⭐⭐ |
| API Key加密 | 本地加密存储 | ⭐⭐ |

**交付物**：
- `docs/prompts/` 目录结构
- `api/prompt_loader.py`
- 洞察模块基础界面
- AI接口设置界面
- `api/unified_client.py`

---

### 阶段三：功能完善（P2）

**目标**：预警机制、典籍基础、帮助系统

| 任务 | 描述 | 预估复杂度 |
|------|------|-----------|
| 洞察-预警规则 | 3级预警逻辑实现 | ⭐⭐⭐ |
| 洞察-关怀响应 | 提示界面 + AI关怀话语 | ⭐⭐ |
| 洞察-免责流程 | "随便说说"引导问题 | ⭐⭐ |
| 洞察-DeepSeek分析 | 画像AI分析功能 | ⭐⭐⭐ |
| 典籍-文档渲染 | Markdown/Word/PDF阅读器 | ⭐⭐⭐⭐ |
| 典籍-资料管理 | 系统资料 + 用户导入 | ⭐⭐ |
| 典籍-笔记系统 | 摘抄 + 标签 + CRUD | ⭐⭐⭐ |
| 典籍-笔记导出 | Markdown/PDF导出 | ⭐⭐ |
| 帮助系统 | 设置内帮助页面 | ⭐⭐ |

**交付物**：
- 完整洞察模块
- 典籍文档阅读器
- 笔记系统
- 帮助页面

---

### 阶段四：智能增强（P3）

**目标**：AI学习助手、RAG问答、引导流程

| 任务 | 描述 | 预估复杂度 |
|------|------|-----------|
| 典籍-AI学习助手 | 总结/洞察/学习方案/心得 | ⭐⭐⭐ |
| RAG索引构建 | 典籍+帮助内容索引 | ⭐⭐⭐⭐ |
| RAG问答实现 | 基于文档内容的问答 | ⭐⭐⭐⭐ |
| 首次引导流程 | 5步引导（可跳过） | ⭐⭐ |

**交付物**：
- AI学习助手功能
- RAG问答系统
- 首次引导界面

---

### 阶段五：内容填充（P4） ✅ 已完成

**目标**：典籍内容、用户文档

**当前进度**：35/35 篇 (100%) ✅

| 任务 | 描述 | 预估复杂度 | 状态 |
|------|------|-----------|------|
| 典籍内容生成 | 35篇约15万字 | ⭐⭐⭐⭐⭐ | ✅ 35/35 |
| 操作手册撰写 | 用户操作手册 | ⭐⭐⭐ | ⏳ 待讨论 |
| 产品介绍撰写 | 市场推广文档 | ⭐⭐ | ⏳ 待讨论 |
| FAQ整理 | 常见问题汇总 | ⭐⭐ | ⏳ 待讨论 |

**典籍生成明细**：
- ✅ 00_入门指南 (3/3)
- ✅ 01_八字 (5/5)
- ✅ 02_紫微斗数 (5/5)
- ✅ 03_奇门遁甲 (5/5)
- ✅ 04_六爻 (5/5)
- ✅ 05_梅花易数 (4/4)
- ✅ 06_小六壬 (3/3)
- ✅ 07_大六壬 (4/4)
- ✅ 08_测字 (3/3)
- ✅ 09_进阶专题 (3/3)

**交付物**：
- `resources/library/` 完整内容
- `docs/user_manual/`
- `docs/marketing/`

---

### 阶段六：国际化（P5）

**目标**：多语言支持（优先级最低，方案保留）

| 任务 | 描述 | 预估复杂度 |
|------|------|-----------|
| i18n框架搭建 | JSON + 加载器 | ⭐⭐⭐ |
| 界面文本提取 | 所有硬编码文本 | ⭐⭐⭐ |
| 6语言翻译 | 简/繁/英/日/韩/德 | ⭐⭐⭐⭐⭐ |
| 术语表翻译 | 专业术语多语言 | ⭐⭐⭐⭐ |
| 免责声明翻译 | 6语言版本 | ⭐⭐⭐ |
| UI自适应 | 不同语言长度适配 | ⭐⭐⭐ |

**交付物**：
- `xuanshu/i18n/` 完整实现
- 6语言支持

---

## 3. 任务清单（按阶段）

### P0 任务清单

- [ ] 设计首次启动界面UI
- [ ] 实现语言选择组件（预留，暂不启用）
- [ ] 实现免责声明展示组件
- [ ] 实现三项勾选确认逻辑
- [ ] 实现简版提示弹窗
- [ ] 实现年龄计算工具函数
- [ ] 实现未成年人检测与提示流程
- [ ] 撰写完整版免责声明文档
- [ ] 重构MainWindow标签页架构
- [ ] 创建典籍标签页占位
- [ ] 创建洞察标签页占位
- [ ] 更新标签页命名

### P1 任务清单

- [ ] 创建 `docs/prompts/` 目录结构
- [ ] 迁移现有Prompt到MD文件
- [ ] 实现 PromptLoader 类
- [ ] 实现变量替换功能
- [ ] 实现A/B变体配置
- [ ] 设置界面添加Prompt配置入口
- [ ] 设计 profile.db 数据库结构
- [ ] 实现使用统计数据收集
- [ ] 实现洞察基础界面
- [ ] 设计AI接口配置数据结构
- [ ] 实现自定义接口添加界面
- [ ] 实现 UnifiedAIClient 类
- [ ] 实现接口分配配置界面
- [ ] 实现故障转移逻辑
- [ ] 实现降级模式
- [ ] 实现API Key加密存储

### P2 任务清单

- [ ] 实现异常模式检测逻辑
- [ ] 实现3级预警响应界面
- [ ] 实现AI关怀话语生成
- [ ] 实现"随便说说"免责流程
- [ ] 集成DeepSeek-Reasoner画像分析
- [ ] 实现Markdown渲染组件
- [ ] 实现Word文档渲染
- [ ] 实现PDF文档渲染
- [ ] 实现资料分类树组件
- [ ] 实现用户资料导入功能
- [ ] 设计 notes.db 数据库结构
- [ ] 实现笔记摘抄功能
- [ ] 实现标签管理功能
- [ ] 实现笔记导出功能
- [ ] 实现帮助页面

### P3 任务清单

- [ ] 实现AI总结功能
- [ ] 实现AI洞察功能
- [ ] 实现学习方案生成
- [ ] 实现心得生成
- [ ] 实现自定义Prompt输出
- [ ] 设计RAG索引结构
- [ ] 实现文档向量化
- [ ] 实现RAG检索与问答
- [ ] 实现首次引导界面
- [ ] 实现5步引导流程

---

## 4. 里程碑

| 里程碑 | 目标版本 | 核心交付 |
|--------|---------|---------|
| M1 | v4.0-alpha | P0完成：基础框架+合规性 |
| M2 | v4.0-beta | P1完成：Prompt+洞察基础+AI接口 |
| M3 | v4.0-rc | P2完成：预警+典籍+帮助 |
| M4 | v4.0 | P3完成：AI助手+RAG+引导 |
| M5 | v4.1 | P4完成：内容填充 |
| M6 | v4.2 | P5完成：多语言（可选） |
