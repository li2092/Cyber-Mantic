# Promptç®¡ç†æ–¹æ¡ˆ

> **ç‰ˆæœ¬**ï¼šv4.0
> **æ›´æ–°æ—¥æœŸ**ï¼š2026-01-05

---

## 1. è®¾è®¡ç›®æ ‡

- å°†Promptä»ä»£ç ä¸­åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤å’Œå®¡æ ¸
- æ”¯æŒå˜é‡æ›¿æ¢ï¼Œæé«˜çµæ´»æ€§
- æ”¯æŒA/Bæµ‹è¯•ï¼Œä¼˜åŒ–Promptæ•ˆæœ

---

## 2. æ–‡ä»¶ç»“æ„

```
docs/prompts/
â”œâ”€â”€ README.md                    # Promptç®¡ç†è§„èŒƒ
â”œâ”€â”€ system/                      # ç³»ç»Ÿçº§
â”‚   â”œâ”€â”€ base_persona.md          # AIäººè®¾åŸºç¡€
â”‚   â””â”€â”€ safety_guidelines.md     # å®‰å…¨å‡†åˆ™
â”‚
â”œâ”€â”€ analysis/                    # åˆ†æç±»ï¼ˆæ¨æ¼”ï¼‰
â”‚   â”œâ”€â”€ bazi/                    # æ”¯æŒå¤šç‰ˆæœ¬çš„ç”¨ç›®å½•
â”‚   â”‚   â”œâ”€â”€ default.md           # é»˜è®¤ç‰ˆæœ¬
â”‚   â”‚   â”œâ”€â”€ variant_a.md         # å˜ä½“Aï¼šç®€æ´é£æ ¼
â”‚   â”‚   â””â”€â”€ variant_b.md         # å˜ä½“Bï¼šè¯¦ç»†é£æ ¼
â”‚   â”œâ”€â”€ ziwei.md                 # å•ç‰ˆæœ¬ç›´æ¥ç”¨æ–‡ä»¶
â”‚   â”œâ”€â”€ qimen.md
â”‚   â”œâ”€â”€ liuyao.md
â”‚   â”œâ”€â”€ meihua.md
â”‚   â”œâ”€â”€ xiaoliu.md
â”‚   â”œâ”€â”€ daliuren.md
â”‚   â”œâ”€â”€ cezi.md
â”‚   â””â”€â”€ comprehensive.md         # ç»¼åˆæŠ¥å‘Š
â”‚
â”œâ”€â”€ conversation/                # å¯¹è¯ç±»ï¼ˆé—®é“ï¼‰
â”‚   â”œâ”€â”€ greeting.md              # å¼€åœºç™½
â”‚   â”œâ”€â”€ clarification.md         # è¿½é—®æ¾„æ¸…
â”‚   â”œâ”€â”€ followup.md              # è¿½é—®æ·±å…¥
â”‚   â””â”€â”€ summary.md               # å¯¹è¯æ€»ç»“
â”‚
â”œâ”€â”€ conflict/                    # å†²çªè§£å†³
â”‚   â””â”€â”€ resolution.md            # å¤šç†è®ºå†²çªè°ƒå’Œ
â”‚
â”œâ”€â”€ insight/                     # æ´å¯Ÿæ¨¡å—
â”‚   â”œâ”€â”€ profile_analysis.md      # ç”»åƒåˆ†æï¼ˆDeepSeekï¼‰
â”‚   â””â”€â”€ care_response.md         # å…³æ€€è¯è¯­ç”Ÿæˆ
â”‚
â””â”€â”€ library/                     # å…¸ç±æ¨¡å—
    â”œâ”€â”€ summarize.md             # æ€»ç»“
    â”œâ”€â”€ insight.md               # æ´å¯Ÿ
    â”œâ”€â”€ study_plan.md            # å­¦ä¹ æ–¹æ¡ˆ
    â””â”€â”€ reflection.md            # å¿ƒå¾—ç”Ÿæˆ
```

---

## 3. Promptæ ¼å¼è§„èŒƒ

### 3.1 åŸºæœ¬æ ¼å¼

çº¯Markdownæ ¼å¼ï¼Œæ”¯æŒå˜é‡æ›¿æ¢ã€‚

### 3.2 å˜é‡è¯­æ³•

```markdown
# å…«å­—åˆ†æPrompt

ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„å…«å­—åˆ†æå¸ˆã€‚

## ç”¨æˆ·ä¿¡æ¯
- å§“åï¼š{{user_name}}
- å‡ºç”Ÿæ—¶é—´ï¼š{{birth_info}}
- æ€§åˆ«ï¼š{{gender}}

## æ’ç›˜ç»“æœ
{{bazi_chart}}

## åˆ†æè¦æ±‚
è¯·æ ¹æ®ä»¥ä¸Šä¿¡æ¯è¿›è¡Œåˆ†æ...
```

### 3.3 æ”¯æŒçš„å˜é‡

| å˜é‡å | è¯´æ˜ |
|--------|------|
| `{{user_name}}` | ç”¨æˆ·å§“å |
| `{{birth_info}}` | å‡ºç”Ÿæ—¶é—´ä¿¡æ¯ |
| `{{gender}}` | æ€§åˆ« |
| `{{bazi_chart}}` | å…«å­—æ’ç›˜ç»“æœ |
| `{{ziwei_chart}}` | ç´«å¾®æ’ç›˜ç»“æœ |
| `{{question}}` | ç”¨æˆ·é—®é¢˜ |
| `{{context}}` | ä¸Šä¸‹æ–‡ä¿¡æ¯ |
| `{{current_date}}` | å½“å‰æ—¥æœŸ |

---

## 4. A/Bæµ‹è¯•æœºåˆ¶

### 4.1 é…ç½®æ–¹å¼

```yaml
# config.yaml
prompts:
  # å…¨å±€é»˜è®¤
  default_variant: "default"

  # å•ç‹¬é…ç½®
  variants:
    analysis/bazi: "variant_a"      # å…«å­—ç”¨å˜ä½“A
    analysis/ziwei: "default"       # ç´«å¾®ç”¨é»˜è®¤
    conversation/greeting: "variant_b"
```

### 4.2 è®¾ç½®ç•Œé¢

é«˜çº§è®¾ç½®ä¸­æ‰€æœ‰ç”¨æˆ·å¯è§ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [è®¾ç½®] > é«˜çº§è®¾ç½® > Prompté…ç½®                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  ğŸ§ª Promptç‰ˆæœ¬é€‰æ‹©                                  â”‚
â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å…«å­—è§£è¯»        [é»˜è®¤ â–¾]                     â”‚   â”‚
â”‚  â”‚                  â”œâ”€ é»˜è®¤                    â”‚   â”‚
â”‚  â”‚                  â”œâ”€ å˜ä½“A (ç®€æ´)            â”‚   â”‚
â”‚  â”‚                  â””â”€ å˜ä½“B (è¯¦ç»†)            â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ ç´«å¾®è§£è¯»        [é»˜è®¤ â–¾]                     â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ å¼€åœºé—®å€™        [é»˜è®¤ â–¾]                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                     â”‚
â”‚  [é¢„è§ˆå½“å‰Prompt]  [æ¢å¤å…¨éƒ¨é»˜è®¤]                    â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. åŠ è½½å™¨å®ç°

```python
# api/prompt_loader.py
from pathlib import Path
from typing import Dict, List, Optional

class PromptLoader:
    def __init__(self, prompts_dir: str = "docs/prompts"):
        self.prompts_dir = Path(prompts_dir)
        self._cache: Dict[str, str] = {}
        self._variants: Dict[str, str] = {}  # ä»configåŠ è½½

    def get(self, category: str, name: str, **variables) -> str:
        """è·å–Promptï¼Œæ”¯æŒå˜ä½“å’Œå˜é‡æ›¿æ¢"""
        # ç¡®å®šä½¿ç”¨å“ªä¸ªå˜ä½“
        key = f"{category}/{name}"
        variant = self._variants.get(key, "default")

        # æ„å»ºè·¯å¾„
        dir_path = self.prompts_dir / category / name
        if dir_path.is_dir():
            path = dir_path / f"{variant}.md"
        else:
            path = self.prompts_dir / category / f"{name}.md"

        # è¯»å–å¹¶ç¼“å­˜
        cache_key = str(path)
        if cache_key not in self._cache:
            self._cache[cache_key] = path.read_text(encoding="utf-8")

        content = self._cache[cache_key]

        # å˜é‡æ›¿æ¢
        for var, value in variables.items():
            content = content.replace(f"{{{{{var}}}}}", str(value))

        return content

    def set_variant(self, key: str, variant: str):
        """è®¾ç½®å˜ä½“ï¼Œæ¸…é™¤ç›¸å…³ç¼“å­˜"""
        self._variants[key] = variant
        self._cache = {k: v for k, v in self._cache.items()
                       if key not in k}

    def list_variants(self, category: str, name: str) -> List[str]:
        """åˆ—å‡ºå¯ç”¨å˜ä½“"""
        dir_path = self.prompts_dir / category / name
        if dir_path.is_dir():
            return [p.stem for p in dir_path.glob("*.md")]
        return ["default"]

    def reload(self):
        """çƒ­é‡è½½ï¼Œæ¸…é™¤æ‰€æœ‰ç¼“å­˜"""
        self._cache.clear()
```

---

## 6. Reviewæµç¨‹

| é˜¶æ®µ | æ–¹å¼ |
|------|------|
| å¼€å‘æœŸ | Git PRå®¡æ ¸ï¼Œæ¯æ¬¡Promptä¿®æ”¹éœ€Review |
| è¿è¡ŒæœŸ | è®¾ç½®é¡µæä¾›"é¢„è§ˆå½“å‰Prompt"åŠŸèƒ½ï¼ˆåªè¯»ï¼‰ |
| ç‰ˆæœ¬ç®¡ç† | Promptæ–‡ä»¶çº³å…¥Gitç‰ˆæœ¬æ§åˆ¶ |
| æ•ˆæœè®°å½• | ä»…å¼€å‘æµ‹è¯•é˜¶æ®µè®°å½•ï¼Œä¾¿äºä¼˜åŒ– |
