# AIæŽ¥å£è®¾è®¡

> **ç‰ˆæœ¬**ï¼šv4.0
> **æ›´æ–°æ—¥æœŸ**ï¼š2026-01-05

---

## 1. è®¾è®¡ç›®æ ‡

- æ”¯æŒé¢„è®¾æŽ¥å£ï¼ˆClaude/Gemini/DeepSeek/Kimiï¼‰
- æ”¯æŒè‡ªå®šä¹‰OpenAIå…¼å®¹æŽ¥å£
- å®žçŽ°æ•…éšœè½¬ç§»ä¸Žé™çº§æœºåˆ¶
- API KeyåŠ å¯†æœ¬åœ°å­˜å‚¨

---

## 2. è®¾ç½®ç•Œé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [è®¾ç½®] > AIæŽ¥å£é…ç½®                                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ é¢„è®¾æŽ¥å£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚                                        â”‚                     â”‚
â”‚  â”‚  â–¡ Claude (Anthropic)     [é…ç½®]       â”‚                     â”‚
â”‚  â”‚  â–¡ Gemini (Google)        [é…ç½®]       â”‚                     â”‚
â”‚  â”‚  â–¡ DeepSeek               [é…ç½®]       â”‚                     â”‚
â”‚  â”‚  â–¡ Kimi (Moonshot)        [é…ç½®]       â”‚                     â”‚
â”‚  â”‚                                        â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ è‡ªå®šä¹‰æŽ¥å£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚                                        â”‚                     â”‚
â”‚  â”‚  [+ æ·»åŠ è‡ªå®šä¹‰æŽ¥å£]                     â”‚                     â”‚
â”‚  â”‚                                        â”‚                     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                     â”‚
â”‚  â”‚  â”‚ ðŸ“¡ æˆ‘çš„æœ¬åœ°LLM                    â”‚  â”‚                     â”‚
â”‚  â”‚  â”‚    Ollama Â· http://localhost:11434â”‚  â”‚                     â”‚
â”‚  â”‚  â”‚    [ç¼–è¾‘] [åˆ é™¤] [æµ‹è¯•è¿žæŽ¥]        â”‚  â”‚                     â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                     â”‚
â”‚  â”‚                                        â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æŽ¥å£åˆ†é… â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚  â”‚                                        â”‚                     â”‚
â”‚  â”‚  é—®é“å¯¹è¯      [DeepSeek        â–¾]     â”‚                     â”‚
â”‚  â”‚  æŽ¨æ¼”åˆ†æž      [Claude          â–¾]     â”‚                     â”‚
â”‚  â”‚  æŠ¥å‘Šç”Ÿæˆ      [Claude          â–¾]     â”‚                     â”‚
â”‚  â”‚  ç”»åƒåˆ†æž      [DeepSeek-R1     â–¾]     â”‚                     â”‚
â”‚  â”‚  å…¸ç±é—®ç­”      [æˆ‘çš„æœ¬åœ°LLM     â–¾]     â”‚                     â”‚
â”‚  â”‚  å†²çªè§£å†³      [Claude          â–¾]     â”‚                     â”‚
â”‚  â”‚                                        â”‚                     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æ·»åŠ è‡ªå®šä¹‰æŽ¥å£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ·»åŠ è‡ªå®šä¹‰AIæŽ¥å£                                         [Ã—]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  æŽ¥å£åç§° *                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æˆ‘çš„æœ¬åœ°LLM                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  æŽ¥å£ç±»åž‹ *                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â—‹ OpenAIå…¼å®¹ (æ”¯æŒå¤§å¤šæ•°æœ¬åœ°/äº‘ç«¯LLM)                    â”‚   â”‚
â”‚  â”‚ â—‹ Anthropicå…¼å®¹                                         â”‚   â”‚
â”‚  â”‚ â—‹ è‡ªå®šä¹‰ (é«˜çº§)                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚  Base URL *                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ http://localhost:11434/v1                                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ðŸ’¡ å¸¸è§æ ¼å¼ï¼š                                                   â”‚
â”‚     Ollama: http://localhost:11434/v1                          â”‚
â”‚     LM Studio: http://localhost:1234/v1                        â”‚
â”‚     vLLM: http://localhost:8000/v1                             â”‚
â”‚                                                                 â”‚
â”‚  API Key (å¯é€‰)                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢                              [ðŸ‘]       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ðŸ’¡ æœ¬åœ°éƒ¨ç½²é€šå¸¸ä¸éœ€è¦API Key                                    â”‚
â”‚                                                                 â”‚
â”‚  æ¨¡åž‹åç§° *                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ qwen2.5:72b                                    [åˆ·æ–°åˆ—è¡¨] â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  ðŸ’¡ æ”¯æŒè‡ªåŠ¨èŽ·å–æ¨¡åž‹åˆ—è¡¨ï¼Œä¹Ÿå¯æ‰‹åŠ¨è¾“å…¥                            â”‚
â”‚                                                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ é«˜çº§è®¾ç½® (å¯é€‰) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚
â”‚                                                                 â”‚
â”‚  æœ€å¤§Tokenæ•°        æ¸©åº¦                 è¶…æ—¶(ç§’)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ 4096        â”‚   â”‚ 0.7         â”‚     â”‚ 60          â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                 â”‚
â”‚  è‡ªå®šä¹‰Headers (JSONæ ¼å¼)                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ {"X-Custom-Header": "value"}                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                 â”‚
â”‚              [æµ‹è¯•è¿žæŽ¥]              [å–æ¶ˆ]    [ä¿å­˜]            â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. æ•°æ®ç»“æž„

### 4.1 æŽ¥å£é…ç½®

```python
from dataclasses import dataclass
from typing import Optional, Dict

@dataclass
class AIEndpoint:
    id: str                          # å”¯ä¸€æ ‡è¯†
    name: str                        # æ˜¾ç¤ºåç§°
    type: str                        # "openai" | "anthropic" | "custom"
    base_url: str                    # APIåœ°å€
    api_key: Optional[str]           # APIå¯†é’¥ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰
    model: str                       # æ¨¡åž‹åç§°
    max_tokens: int = 4096           # æœ€å¤§Token
    temperature: float = 0.7         # æ¸©åº¦
    timeout: int = 60                # è¶…æ—¶ç§’æ•°
    headers: Dict[str, str] = None   # è‡ªå®šä¹‰Headers
    is_preset: bool = False          # æ˜¯å¦é¢„è®¾æŽ¥å£
    enabled: bool = True             # æ˜¯å¦å¯ç”¨
```

### 4.2 æŽ¥å£åˆ†é…é…ç½®

```python
@dataclass
class AIRoutingConfig:
    """æŽ¥å£åˆ†é…é…ç½®"""
    wendao: str          # é—®é“å¯¹è¯
    tuiyan: str          # æŽ¨æ¼”åˆ†æž
    report: str          # æŠ¥å‘Šç”Ÿæˆ
    profile: str         # ç”»åƒåˆ†æž
    library: str         # å…¸ç±é—®ç­”
    conflict: str        # å†²çªè§£å†³
```

### 4.3 é…ç½®æ–‡ä»¶ç¤ºä¾‹

```yaml
# config.yaml
ai_endpoints:
  presets:
    claude:
      enabled: true
      api_key_env: "ANTHROPIC_API_KEY"
      model: "claude-3-5-sonnet-20241022"
    deepseek:
      enabled: true
      base_url: "https://api.deepseek.com/v1"
      api_key_env: "DEEPSEEK_API_KEY"
      model: "deepseek-chat"
    deepseek-reasoner:
      enabled: true
      base_url: "https://api.deepseek.com/v1"
      api_key_env: "DEEPSEEK_API_KEY"
      model: "deepseek-reasoner"

  custom:
    - id: "local_ollama"
      name: "æˆ‘çš„æœ¬åœ°LLM"
      type: "openai"
      base_url: "http://localhost:11434/v1"
      model: "qwen2.5:72b"
      api_key: null

ai_routing:
  wendao: "deepseek"
  tuiyan: "claude"
  report: "claude"
  profile: "deepseek-reasoner"
  library: "local_ollama"
  conflict: "claude"

ai_fallback:
  - "claude"
  - "deepseek"
  - "local_ollama"
```

---

## 5. æ•…éšœè½¬ç§»ä¸Žé™çº§

### 5.1 æµç¨‹å›¾

```
ç”¨æˆ·è¯·æ±‚
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸»æŽ¥å£è°ƒç”¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€ æˆåŠŸ â”€â”€â†’ è¿”å›žç»“æžœ
       â”‚
       â–¼ å¤±è´¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤‡ç”¨æŽ¥å£1   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€ æˆåŠŸ â”€â”€â†’ è¿”å›žç»“æžœ
       â”‚
       â–¼ å¤±è´¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¤‡ç”¨æŽ¥å£2   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€ æˆåŠŸ â”€â”€â†’ è¿”å›žç»“æžœ
       â”‚
       â–¼ å…¨éƒ¨å¤±è´¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é™çº§æ¨¡å¼ï¼šç®€ç‰ˆåˆ†æž               â”‚
â”‚ â€¢ ä»…è¾“å‡ºæŽ’ç›˜æ•°æ®ï¼ˆæ— AIè§£è¯»ï¼‰     â”‚
â”‚ â€¢ æ˜¾ç¤ºé¢„è®¾çš„é€šç”¨è§£é‡Šæ–‡æœ¬         â”‚
â”‚ â€¢ æç¤ºç”¨æˆ·æ£€æŸ¥ç½‘ç»œ/æŽ¥å£é…ç½®      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 é™çº§æ¨¡å¼å†…å®¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                     â”‚
â”‚  âš ï¸ AIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨                                â”‚
â”‚                                                     â”‚
â”‚  å·²ä¸ºæ‚¨ç”ŸæˆåŸºç¡€æŽ’ç›˜ç»“æžœï¼ŒAIè§£è¯»åŠŸèƒ½æš‚æ—¶æ— æ³•ä½¿ç”¨ã€‚    â”‚
â”‚                                                     â”‚
â”‚  è¯·æ£€æŸ¥ï¼š                                           â”‚
â”‚  â€¢ ç½‘ç»œè¿žæŽ¥æ˜¯å¦æ­£å¸¸                                 â”‚
â”‚  â€¢ API Keyæ˜¯å¦æ­£ç¡®é…ç½®                              â”‚
â”‚  â€¢ è‡ªå®šä¹‰æŽ¥å£æ˜¯å¦å¯ç”¨                               â”‚
â”‚                                                     â”‚
â”‚  [å‰å¾€è®¾ç½®æ£€æŸ¥]                                     â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ç»Ÿä¸€å®¢æˆ·ç«¯å®žçŽ°

```python
# api/unified_client.py
from typing import List, Dict, Optional
import asyncio

class UnifiedAIClient:
    """ç»Ÿä¸€AIå®¢æˆ·ç«¯ï¼Œæ”¯æŒå¤šç§æŽ¥å£ç±»åž‹"""

    def __init__(self, endpoint: AIEndpoint):
        self.endpoint = endpoint
        self._client = self._create_client()

    def _create_client(self):
        if self.endpoint.type == "openai":
            from openai import AsyncOpenAI
            return AsyncOpenAI(
                base_url=self.endpoint.base_url,
                api_key=self.endpoint.api_key or "not-needed",
                timeout=self.endpoint.timeout
            )
        elif self.endpoint.type == "anthropic":
            from anthropic import AsyncAnthropic
            return AsyncAnthropic(api_key=self.endpoint.api_key)
        # ... å…¶ä»–ç±»åž‹

    async def chat(self, messages: List[Dict], **kwargs) -> str:
        """ç»Ÿä¸€çš„å¯¹è¯æŽ¥å£"""
        if self.endpoint.type == "openai":
            response = await self._client.chat.completions.create(
                model=self.endpoint.model,
                messages=messages,
                max_tokens=kwargs.get("max_tokens", self.endpoint.max_tokens),
                temperature=kwargs.get("temperature", self.endpoint.temperature)
            )
            return response.choices[0].message.content
        elif self.endpoint.type == "anthropic":
            response = await self._client.messages.create(
                model=self.endpoint.model,
                messages=messages,
                max_tokens=kwargs.get("max_tokens", self.endpoint.max_tokens)
            )
            return response.content[0].text
        # ... å…¶ä»–ç±»åž‹å¤„ç†

    async def list_models(self) -> List[str]:
        """èŽ·å–å¯ç”¨æ¨¡åž‹åˆ—è¡¨"""
        if self.endpoint.type == "openai":
            try:
                models = await self._client.models.list()
                return [m.id for m in models.data]
            except Exception:
                return []
        return []
```

---

## 7. API KeyåŠ å¯†å­˜å‚¨

```python
# utils/crypto.py
from cryptography.fernet import Fernet
import os

class APIKeyManager:
    def __init__(self):
        self._key = self._get_or_create_key()
        self._cipher = Fernet(self._key)

    def _get_or_create_key(self) -> bytes:
        key_path = os.path.expanduser("~/.xuanshu/.keyfile")
        if os.path.exists(key_path):
            with open(key_path, "rb") as f:
                return f.read()
        else:
            key = Fernet.generate_key()
            os.makedirs(os.path.dirname(key_path), exist_ok=True)
            with open(key_path, "wb") as f:
                f.write(key)
            os.chmod(key_path, 0o600)  # ä»…æ‰€æœ‰è€…å¯è¯»å†™
            return key

    def encrypt(self, api_key: str) -> str:
        return self._cipher.encrypt(api_key.encode()).decode()

    def decrypt(self, encrypted_key: str) -> str:
        return self._cipher.decrypt(encrypted_key.encode()).decode()
```
